<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin System Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1e293b;
            margin-bottom: 20px;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            background: #f9fafb;
        }
        .test-result {
            margin: 10px 0;
            padding: 8px 12px;
            border-radius: 4px;
        }
        .success {
            background: #dcfce7;
            color: #166534;
            border: 1px solid #bbf7d0;
        }
        .warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }
        .error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }
        .button {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #2563eb;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #1e293b;
        }
        .stat-label {
            color: #64748b;
            margin-top: 5px;
        }
        .admin-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .admin-link {
            display: block;
            padding: 15px;
            background: #3b82f6;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            text-align: center;
            transition: all 0.2s;
        }
        .admin-link:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }
        .log {
            background: #1f2937;
            color: #f9fafb;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Blue Bay Admin System Test Dashboard</h1>
        
        <div class="test-section">
            <h2>üîê Authentication Status</h2>
            <div id="auth-status"></div>
            <button class="button" onclick="simulateAdminLogin()">Simulate Admin Login</button>
            <button class="button" onclick="clearAuth()">Clear Auth</button>
        </div>

        <div class="test-section">
            <h2>üìä System Statistics</h2>
            <div class="stats" id="stats-container"></div>
            <button class="button" onclick="updateStats()">Refresh Stats</button>
        </div>

        <div class="test-section">
            <h2>‚öôÔ∏è Settings Test</h2>
            <div id="settings-status"></div>
            <button class="button" onclick="testSettings()">Test Settings Save/Load</button>
            <button class="button" onclick="resetSettings()">Reset to Defaults</button>
        </div>

        <div class="test-section">
            <h2>üè¢ Data Management Test</h2>
            <div id="data-status"></div>
            <button class="button" onclick="testPropertyManagement()">Test Properties</button>
            <button class="button" onclick="testBookingManagement()">Test Bookings</button>
            <button class="button" onclick="testUserManagement()">Test Users</button>
        </div>

        <div class="test-section">
            <h2>üß≠ Admin Navigation Links</h2>
            <p>Test these links to verify admin functionality:</p>
            <div class="admin-links">
                <a href="http://localhost:5173/admin" class="admin-link" target="_blank">üè† Admin Dashboard</a>
                <a href="http://localhost:5173/admin/properties" class="admin-link" target="_blank">üè¢ Properties</a>
                <a href="http://localhost:5173/admin/bookings" class="admin-link" target="_blank">üìÖ Bookings</a>
                <a href="http://localhost:5173/admin/users" class="admin-link" target="_blank">üë• Users</a>
                <a href="http://localhost:5173/admin/settings" class="admin-link" target="_blank">‚öôÔ∏è Settings</a>
                <a href="http://localhost:5173/admin/system" class="admin-link" target="_blank">üñ•Ô∏è System</a>
                <a href="http://localhost:5173/admin/audit-logs" class="admin-link" target="_blank">üìã Audit Logs</a>
                <a href="http://localhost:5173/admin/messages" class="admin-link" target="_blank">üí¨ Messages</a>
            </div>
        </div>

        <div class="test-section">
            <h2>üìù Test Log</h2>
            <button class="button" onclick="runAllTests()">Run All Tests</button>
            <button class="button" onclick="clearLog()">Clear Log</button>
            <div class="log" id="test-log"></div>
        </div>
    </div>

    <script>
        // Test data
        const testProperty = {
            title: 'Test Admin Property',
            description: 'Property created by admin for testing',
            location: 'Admin Test Location',
            price: 199,
            priceUnit: 'night',
            bedrooms: 3,
            bathrooms: 2,
            amenities: ['WiFi', 'Pool', 'Kitchen'],
            category: 'apartment',
            status: 'approved'
        };

        const testBooking = {
            propertyName: 'Test Property',
            guestName: 'Test Guest',
            guestEmail: 'guest@test.com',
            checkIn: '2025-01-15',
            checkOut: '2025-01-20',
            guests: 2,
            amount: 995,
            status: 'pending'
        };

        const testUser = {
            name: 'Test User',
            email: 'testuser@example.com',
            phone: '+1234567890',
            role: 'customer',
            status: 'active'
        };

        const testSettingsData = {
            siteName: 'Blue Bay Booking - Test',
            siteDescription: 'Test description for Blue Bay',
            contactEmail: 'contact@bluebay-test.com',
            contactPhone: '+212 539 999 888',
            facebook: 'https://facebook.com/bluebay-test',
            instagram: 'https://instagram.com/bluebay-test',
            maintenanceMode: false,
            allowRegistration: true,
            maxFileUploadSize: 10,
            defaultCurrency: 'EUR'
        };

        // Utility functions
        function log(message, type = 'info') {
            const logElement = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }

        function clearLog() {
            document.getElementById('test-log').innerHTML = '';
        }

        function showResult(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="test-result ${type}">${message}</div>`;
        }

        // Authentication functions
        function simulateAdminLogin() {
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userRole', 'admin');
            localStorage.setItem('userName', 'Admin User');
            localStorage.setItem('userEmail', 'admin@bluebay.com');
            localStorage.setItem('loginMethod', 'manual');
            
            updateAuthStatus();
            log('‚úÖ Admin authentication simulated successfully');
        }

        function clearAuth() {
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userRole');
            localStorage.removeItem('userName');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('loginMethod');
            
            updateAuthStatus();
            log('üîÑ Authentication cleared');
        }

        function updateAuthStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
            const userRole = localStorage.getItem('userRole');
            const userName = localStorage.getItem('userName');
            
            if (isLoggedIn && userRole === 'admin') {
                showResult('auth-status', `‚úÖ Logged in as: ${userName} (${userRole})`, 'success');
            } else if (isLoggedIn) {
                showResult('auth-status', `‚ö†Ô∏è Logged in as: ${userName} (${userRole}) - Not admin`, 'warning');
            } else {
                showResult('auth-status', '‚ùå Not logged in', 'error');
            }
        }

        // Statistics functions
        function updateStats() {
            try {
                const properties = JSON.parse(localStorage.getItem('properties') || '[]');
                const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                const users = JSON.parse(localStorage.getItem('martilhaven_users') || '[]');
                const messages = JSON.parse(localStorage.getItem('contact_messages') || '[]');
                
                const stats = [
                    { label: 'Total Properties', value: properties.length },
                    { label: 'Pending Properties', value: properties.filter(p => p.status === 'pending').length },
                    { label: 'Total Bookings', value: bookings.length },
                    { label: 'Pending Bookings', value: bookings.filter(b => b.status === 'pending').length },
                    { label: 'Total Users', value: users.length },
                    { label: 'New Messages', value: messages.filter(m => m.status === 'new').length }
                ];
                
                const statsContainer = document.getElementById('stats-container');
                statsContainer.innerHTML = stats.map(stat => `
                    <div class="stat-card">
                        <div class="stat-value">${stat.value}</div>
                        <div class="stat-label">${stat.label}</div>
                    </div>
                `).join('');
                
                log('üìä Statistics updated successfully');
            } catch (error) {
                log(`‚ùå Error updating statistics: ${error.message}`);
            }
        }

        // Settings functions
        function testSettings() {
            try {
                // Save test settings
                localStorage.setItem('admin_settings', JSON.stringify(testSettingsData));
                
                // Load and verify
                const loaded = JSON.parse(localStorage.getItem('admin_settings'));
                
                if (loaded.siteName === testSettingsData.siteName) {
                    showResult('settings-status', '‚úÖ Settings save/load working correctly', 'success');
                    log('‚úÖ Settings test passed');
                    log(`   Site Name: ${loaded.siteName}`);
                    log(`   Currency: ${loaded.defaultCurrency}`);
                    log(`   Contact: ${loaded.contactEmail}`);
                } else {
                    showResult('settings-status', '‚ùå Settings test failed', 'error');
                    log('‚ùå Settings test failed');
                }
            } catch (error) {
                showResult('settings-status', `‚ùå Settings error: ${error.message}`, 'error');
                log(`‚ùå Settings test error: ${error.message}`);
            }
        }

        function resetSettings() {
            localStorage.removeItem('admin_settings');
            showResult('settings-status', 'üîÑ Settings reset to defaults', 'warning');
            log('üîÑ Settings reset to defaults');
        }

        // Data management functions
        function testPropertyManagement() {
            try {
                const properties = JSON.parse(localStorage.getItem('properties') || '[]');
                
                // Add test property
                const newProperty = {
                    ...testProperty,
                    id: generateId(),
                    createdAt: new Date().toISOString()
                };
                
                properties.push(newProperty);
                localStorage.setItem('properties', JSON.stringify(properties));
                
                showResult('data-status', '‚úÖ Property management test passed', 'success');
                log('‚úÖ Property created successfully');
                log(`   Property ID: ${newProperty.id}`);
                log(`   Title: ${newProperty.title}`);
                
                updateStats();
            } catch (error) {
                showResult('data-status', `‚ùå Property test error: ${error.message}`, 'error');
                log(`‚ùå Property test error: ${error.message}`);
            }
        }

        function testBookingManagement() {
            try {
                const bookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                
                // Add test booking
                const newBooking = {
                    ...testBooking,
                    id: generateId(),
                    createdAt: new Date().toISOString()
                };
                
                bookings.push(newBooking);
                localStorage.setItem('bookings', JSON.stringify(bookings));
                
                showResult('data-status', '‚úÖ Booking management test passed', 'success');
                log('‚úÖ Booking created successfully');
                log(`   Booking ID: ${newBooking.id}`);
                log(`   Guest: ${newBooking.guestName}`);
                
                updateStats();
            } catch (error) {
                showResult('data-status', `‚ùå Booking test error: ${error.message}`, 'error');
                log(`‚ùå Booking test error: ${error.message}`);
            }
        }

        function testUserManagement() {
            try {
                const users = JSON.parse(localStorage.getItem('martilhaven_users') || '[]');
                
                // Add test user
                const newUser = {
                    ...testUser,
                    id: generateId(),
                    registeredDate: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };
                
                users.push(newUser);
                localStorage.setItem('martilhaven_users', JSON.stringify(users));
                
                showResult('data-status', '‚úÖ User management test passed', 'success');
                log('‚úÖ User created successfully');
                log(`   User ID: ${newUser.id}`);
                log(`   Name: ${newUser.name}`);
                
                updateStats();
            } catch (error) {
                showResult('data-status', `‚ùå User test error: ${error.message}`, 'error');
                log(`‚ùå User test error: ${error.message}`);
            }
        }

        // Run all tests
        function runAllTests() {
            log('üöÄ Starting comprehensive admin test...');
            
            setTimeout(() => {
                simulateAdminLogin();
            }, 500);
            
            setTimeout(() => {
                testSettings();
            }, 1000);
            
            setTimeout(() => {
                testPropertyManagement();
            }, 1500);
            
            setTimeout(() => {
                testBookingManagement();
            }, 2000);
            
            setTimeout(() => {
                testUserManagement();
            }, 2500);
            
            setTimeout(() => {
                updateStats();
                log('‚úÖ All tests completed!');
            }, 3000);
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateAuthStatus();
            updateStats();
            log('üéØ Admin test dashboard initialized');
            log('üìù Click buttons above to test admin functionality');
            log('üîó Use navigation links to test actual admin pages');
        });
    </script>
</body>
</html>
